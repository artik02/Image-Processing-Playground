<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patio de juegos de Procesamiento de Im√°genes</title>
    <script src="https://artik02.github.io/Yotta.js/yotta.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <script src="language.js"></script>
  <script src="image-processing.js"></script>
  <script src="global.js"></script>
  <script type="text/javascript">

    /* File input tag */

    const fileSelector = Input('file').Id('fileSelector').Att('accept', 'image/*');
    fileSelector.addEventListener('change', (e) => { fileSelectorChange(e); }, false);

    /* Canvases tag */

    const imgHidden = Img('').Id('imageHidden').Att('style', 'display: none;');
    imgHidden.onload = () => { imageReady(); };

    const cnvSource = Canvas('').Class('responsive-canvas').Id('canvasSource');
    const cnvPreview = Canvas('').Class('responsive-canvas').Id('canvasPreview');

    /* App buttons */

    const btnRestore = Button(H3(getText('btnRestore'))).Class('toolbox-button').Id('buttonRestore');
    btnRestore.addEventListener('click', (e) => { restoreImage(); });

    const btnRestorePrev = Button(H3(getText('btnRestorePrev'))).Class('toolbox-button').Id('buttonRestorePrev');
    btnRestorePrev.addEventListener('click', (e) => { restorePreview(); });

    const btnApply = Button(H3(getText('btnApply'))).Class('toolbox-button').Id('buttonApply');
    btnApply.addEventListener('click', (e) => { applyChanges(); });

    /* Image Processing buttons */

    const btnMinimum = Button(H3(getText('btnMinimum'))).Class('toolbox-button').Id('buttonMinimum');
    btnMinimum.addEventListener('click', (e) => { minimumFilter(); });

    const btnGamma = Button(H3(getText('btnGamma'))).Class('toolbox-button').Id('buttonGamma');
    btnGamma.addEventListener('click', (e) => { replaceToolbox(GammaArticle); });

    const btnRoberts = Button(H3(getText('btnRoberts'))).Class('toolbox-button').Id('buttonRoberts');
    btnRoberts.addEventListener('click', (e) => { replaceToolbox(RobertsArticle); });

    /* Toolbox component container */

    const Toolbox = Section().Id('toolbox');

    /* Gamma component */

    const lblGamma = Label('rangeGamma', getText('lblGamma') + '1.0').Class('toolbox-label').Id('labelGamma');
    const rngGamma = Input('range', '1.0').Att('min', '0.1').Att('max', '2.0').Att('step', '0.05').Class('toolbox-range').Id('rangeGamma')
      .Att('onchange', 'gammaCorrection(rngGamma.value);')
      .Att('oninput', 'lblGamma.replaceChildren(getText("lblGamma") + rngGamma.value);');

    const GammaArticle = Article(
      lblGamma,
      rngGamma,
    ).Class('toolbox-component');

    /* Roberts component */
    
    const lblRoberts = Label('rangeGamma', getText('lblRoberts') + '1.0').Class('toolbox-label').Id('labelGamma');
    const rngRoberts = Input('range', '128').Att('min', '1').Att('max', '254').Att('step', '1').Class('toolbox-range').Id('rangeGamma')
      .Att('onchange', 'robertsFilter(rngRoberts.value);')
      .Att('oninput', 'lblRoberts.replaceChildren(getText("lblRoberts") + rngRoberts.value);');
    
    const RobertsArticle = Article(
      lblRoberts,
      rngRoberts,
    ).Class('toolbox-component');

    /* UI components */
      
    const ToolboxCanvases = Section(
      imgHidden,
      Article(
        H3(getText('lblSource')).Class('labelImages'),
        cnvSource,
      ).Class('toolboxImages'),
      Article(
        H3(getText('lblPreview')).Class('labelImages'),
        cnvPreview,
      ).Class('toolboxImages') ,
    ).Id('toolboxCanvases').Att('style', 'display: none;');

    const ToolboxButtons = Section(
      btnRestore,
      btnRestorePrev,
      btnApply,
    ).Id('toolboxButtons');

    const ToolboxButtonsPro = Section(
      btnGamma,
      btnMinimum,
      btnRoberts,
    ).Id('toolboxButtons');

    /* App structure */
    
    const MyHeader = Header(
      Label('fileSelector', H1(getText('playgroundTitle') + '...').Att('style', 'text-align: center;').Id('playgroundTitle')),
      fileSelector,
    );

    const MyMain = Main(
      ToolboxCanvases,
      Toolbox,
      ToolboxButtons,
      ToolboxButtonsPro,
    );

    const MyFooter = Footer(
      P('(c) ', A('https://github.com/artik02/Image-Processing-Playground/', getText('playgroundTitle')), ' - 2024'),
    );

    /* App deployment */

    const App = Yotta(
      MyHeader,
      MyMain,
      MyFooter,
    );

    document.body.appendChild(App);

  </script>
  <script async src="https://docs.opencv.org/3.4.0/opencv.js" onload="openCVReady()"></script>
</body>
</html>
